import{z as n,r as i,j as t,F as k,A,P as T,t as W,k as v,v as G,w as H,C as X,c as N,D as J}from"./index-DSXsjQfW.js";import{u as K,C as Q,a as Y,b as Z,c as g,d as I,e as ee,f,g as te}from"./useCrudPanel-BnfChyCa.js";import{C as se}from"./CrudBackground-CIVg33FB.js";const h="businesses";function re(e){return e.map(({...s})=>({...s}))}async function me(){const e=await n({resource:h});return re(e)}async function he({data:e}){return await n({resource:h,data:e,method:"POST",all:!0,formData:!0})}async function xe({id:e,data:s}){return await n({resource:h+"/"+e,data:s,method:"POST",all:!0,formData:!0})}async function ye({id:e}){return await n({resource:h+"/"+e,method:"DELETE",all:!0})}function ge({children:e}){const[s,a]=i.useState(!1),c=i.useRef(null);return i.useEffect(()=>{function u(d){c.current&&!c.current.contains(d.target)&&a(!1)}return document.addEventListener("click",u),()=>{document.removeEventListener("click",u)}},[]),t.jsx("div",{ref:c,className:"flex flex-col justify-center items-center w-full",children:t.jsxs("div",{className:"relative w-10 aspect-square",children:[t.jsx("button",{className:"flex justify-center items-center w-full h-full rounded-full cursor-pointer opacity-60 hover:opacity-100 hover:bg-black/10",onClick:()=>a(!s),children:t.jsx(k,{icon:A,className:"text-lg"})}),t.jsx("div",{className:"absolute right-[calc(100%+5px)] top-[50%] translate-y-[-50%] overflow-hidden flex h-auto gap-1 bg-white/40 rounded-lg shadow "+(s?"max-w-[500px] p-2 opacity-100":"max-w-0 p-0 opacity-0"),children:e})]})})}const x="products";function ae(e){return e.map(({...s})=>({...s}))}async function ne(){const e=await n({resource:x+"?includeCategory=true"});return ae(e)}async function oe({data:e}){return await n({resource:x,data:e,method:"POST",all:!0,formData:!0})}async function ce({id:e,data:s}){return await n({resource:x+"/"+e,data:s,method:"POST",all:!0,formData:!0})}async function ue({id:e}){return await n({resource:x+"/"+e,method:"DELETE",all:!0})}const m="categories";function D(e){return e.map(({...s})=>({...s}))}async function ie(){const e=await n({resource:m});return D(e)}async function je(){const e=await n({resource:m+"?includeBusiness=true"});return D(e)}async function Ce({data:e}){return await n({resource:m+"?includeBusiness=true",data:e,method:"POST",all:!0})}async function we({id:e,data:s}){return await n({resource:m+"/"+e+"?includeBusiness=true",data:s,method:"PUT",all:!0,printResponse:!0})}async function be({id:e}){return await n({resource:m+"/"+e,method:"DELETE",all:!0})}function le({businessId:e=null}){const s=(r,l)=>{var w,b,E,P;let o=!0;return(b=(w=r.photo)==null?void 0:w.files)!=null&&b.length&&((P=(E=r.photo)==null?void 0:E.files[0])==null?void 0:P.size)>2e6&&(l("La foto debe pesar maximo 2MB"),o=!1),o},{entityName:a,pluralEntityName:c,head:u,table:d,form:O,confirm:S,progress:B,datalist:p,$form:F,handleModeNew:M,handleModeEdit:L,handleModeDelete:R,hanleCancel:j,handleSubmit:q,handleDelete:_,searchValue:U,searchOnChange:V}=K({entityName:"Product",pluralEntityName:"Productos",excludeFieldsValidationEdit:["photo"],searchFields:["name","description","price"],extraValidations:s,isStorageMultipartFormData:!0,isUpdateMultipartFormData:!0,crudGet:ne,crudStorage:oe,crudUpdate:ce,crudDestroy:ue}),[$,C]=i.useState([]);i.useEffect(()=>{ie().then(r=>{if(!r)return;if(!e)return C(r);const l=r.filter(o=>(o==null?void 0:o.business_id)==e);C(l)})},[e]);const[z,y]=i.useState(null);return i.useEffect(()=>{if(!e||!p)return y(p);const r=p.filter(l=>{var o;return((o=l==null?void 0:l.category)==null?void 0:o.business_id)==e});y(r)},[e,p]),t.jsxs(T,{className:"flex flex-col gap-7 w-full",children:[!e&&t.jsx(se,{src:"/image/food3.jpg"}),t.jsx(Q,{title:c,icon:W,isOpen:u,onClickNew:M,searchValue:U,searchOnChange:V}),t.jsx(Y,{titles:["Foto","Nombre","Descripcion","Precio"],dataList:z,isOpen:d,onRowPrint:r=>t.jsxs("tr",{children:[t.jsx(Z,{src:r.photo_url,alt:"Foto "+r.name}),t.jsx(g,{value:r.name}),t.jsx(g,{value:r.description}),t.jsx(g,{value:r.price}),t.jsxs(I,{children:[t.jsx(v,{text:"Editar",icon:G,type:"edit",onClick:()=>L(r)}),t.jsx(v,{text:"Borrar",icon:H,type:"delete",onClick:()=>R(r)})]})]},r.id)}),t.jsxs(ee,{title:a,isOpen:O,onClickCancel:j,onSubmit:q,formRef:F,children:[t.jsx(f,{label:"Nombre",placeholder:"Escriba el nombre del producto",name:"name",required:!0}),t.jsx(f,{label:"Descripcion",placeholder:"Escriba una descripcion",name:"description",required:!0}),t.jsx(f,{label:"Precio",placeholder:"Escriba su numero de celular",name:"price",required:!0}),t.jsx(f,{label:"Foto",name:"photo",type:"file"}),t.jsxs(f,{label:"Categoria",name:"category_id",type:"select",required:!0,children:[t.jsx("option",{value:"",children:"Seleccione una categoria"}),$.map(r=>t.jsx("option",{value:r.id,children:r.name},r.id))]})]}),t.jsx(te,{isOpen:S,text:"Â¿Seguro de eliminar este usuario?",onClickDelete:_,onClickCancel:j}),t.jsx(X,{isOpen:B,text:"Procesando tu solicitud..."})]})}function Ee({businessId:e,setBusinessId:s}){const a=e!==null,c=()=>s(null),u=i.useRef();return document.addEventListener("click",d=>{u.current&&d.target===u.current&&c()}),t.jsx(T,{className:N("fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[1000] w-full h-full bg-black/40",{"w-0 h-0 overflow-hidden opacity-0":!a,"w-full h-full opacity-100":a}),children:t.jsxs("div",{ref:u,className:"relative flex justify-center items-center w-full h-full cursor-pointer",children:[t.jsx("button",{className:"absolute top-1 right-1 flex justify-center items-center w-10 aspect-square rounded-full bg-black/50 opacity-50 hover:opacity-100 transition-all duration-200 cursor-pointer",onClick:c,children:t.jsx(k,{icon:J,className:"text-white text-2xl"})}),t.jsx("div",{className:N("container flex justify-center items-center bg-white rounded-xl",{"p-[--pdd]":a,"p-0":!a}),children:a&&t.jsx(le,{businessId:e})})]})})}export{ge as C,Ee as M,je as a,Ce as b,we as c,ye as d,be as e,me as g,he as s,xe as u};
